<span class="fs-2">Timestamp</span>
<span class="fs-5 d-block mt-3">Convert timestamp to readable time</span>
<div class="input-group mt-1">
    <span class="input-group-text">UNIX Timestamp</span>
    <input type="number" class="form-control" id="timestamp" min="0" max="2147483647">
</div>
<div class="input-group mt-2">
    <span class="input-group-text">Date string</span>
    <input type="text" class="form-control" id="date" readonly>
</div>

<hr>

<span class="fs-5 d-block">Convert date and time to timestamp</span>
<div class="input-group mt-2">
    <input type="text" class="form-control" id="date-picker" placeholder="Select date and time" onclick="picker.open()">
    <span class="input-group-text" id="btn-copy" style="cursor: pointer;"> <i id="btn-copy-tooltip" class="bi bi-clipboard" data-bs-toggle="tooltip" data-bs-title="Copied to clipboard!" data-bs-trigger="manual"></i></span>
</div>


<script id="flatpickr-js" type="text/javascript" src="assets/js/flatpickr.min.js"></script>
<script>
    $(update);

    Toolbox.registerEvent("#flatpickr-js", "load", function() {
        picker = $("#date-picker").flatpickr({
            enableTime: true,
            enableSeconds: true,
            dateFormat: "U",
            clickOpens: false
        });
    });

    Toolbox.registerEvent("#btn-copy", "click", function() {
        var input = document.getElementById("date-picker");

        input.select();
        input.setSelectionRange(0, 99999);

        navigator.clipboard.writeText(input.value);

        window.getSelection().removeAllRanges();

        if ($("#btn-copy").hasClass("disabled"))
            return;

        $("#btn-copy-tooltip").tooltip("show");
        $("#btn-copy").addClass("disabled");
        setTimeout(() => {
            $("#btn-copy-tooltip").tooltip("hide");
            $("#btn-copy").removeClass("disabled");
        }, 1000);
    });

    Toolbox.registerEvent("#timestamp", "input", update);

    function uts() {
        return Math.round(Date.now()/1000);
    }

    function isTimestampValid(str) {
        const num = parseInt(str, 10);

        if (isNaN(num) || num <= 0) {
            return false;
        }

        return num <= 2147483647;
    }

    function getDateString(timestamp) {
        return new Date(timestamp*1000).toLocaleString(undefined);
    }

    function update() {
        let timestamp;
        let ts_input = $("#timestamp").val();
        if (!isTimestampValid(ts_input)) {
            timestamp = uts();
        } else {
            timestamp = parseInt(ts_input);
        }

        $("#timestamp").val(timestamp);
        $("#date").val(getDateString(timestamp));   
    }
</script>