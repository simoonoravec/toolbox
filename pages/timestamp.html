<span class="fs-2">Timestamp</span>
<span class="mt-3 d-block">Locale selector</span>
<div class="mb-3">
    <select class="form-select width-auto d-inline" id="locale-selector" aria-label="Locale selector" hx-get="pages/ext/locales.html" hx-trigger="load delay:100ms" hx-vals='{"noUnregisterEvents": true}'>
    </select>
</div>
<span class="fs-5 d-block">Convert timestamp to readable time</span>
<div class="input-group mt-1">
    <span class="input-group-text">UNIX Timestamp</span>
    <input type="number" class="form-control" id="timestamp" min="0" max="2147483647">
</div>
<div class="input-group mt-2">
    <span class="input-group-text">Date string</span>
    <input type="text" class="form-control" id="date" readonly>
</div>

<hr>

<span class="fs-5 d-block">Convert date and time to timestamp</span>
<input type="text" class="form-control" id="date-picker" placeholder="Click here and set the date and time">

<script id="flatpickr-js" type="text/javascript" src="assets/js/flatpickr.min.js"></script>
<script>
    $("head").append('<link rel="stylesheet" href="assets/css/flatpickr.min.css">');
    $(update);

    Toolbox.registerEvent("#flatpickr-js", "load", function() {
        $("#date-picker").flatpickr({
            enableTime: true,
            enableSeconds: true,
            dateFormat: "U"
        });
    });

    Toolbox.registerEvent("#locale-selector", "change", update);
    Toolbox.registerEvent("#timestamp", "input", update);

    function uts() {
        return Math.round(Date.now()/1000);
    }

    function isLocaleValid(locale) {
        try {
            new Intl.DateTimeFormat(locale);
            return true;
        } catch (error) {
            return false;
        }
    }

    function isTimestampValid(str) {
        const num = parseInt(str, 10);

        if (isNaN(num) || num <= 0) {
            return false;
        }

        return num <= 2147483647;
    }

    function getDateString(timestamp) {
        let locale = $("#locale-selector").val();
        if (locale == '0') {
            locale = undefined;
        } else {
            if (!isLocaleValid(locale)) {
                locale = undefined;
                $("#locale-selector").val("0");
            }
        }

        return new Date(timestamp*1000).toLocaleString(locale);
    }

    function update() {
        let timestamp;
        let ts_input = $("#timestamp").val();
        if (!isTimestampValid(ts_input)) {
            timestamp = uts();
        } else {
            timestamp = parseInt(ts_input);
        }

        $("#timestamp").val(timestamp);
        $("#date").val(getDateString(timestamp));   
    }
</script>